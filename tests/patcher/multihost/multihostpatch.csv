action,ms,bytes,lang,code,repeat,minver,comment
beforeany,0,0,q,system "sleep 5",1,,"Wait for all procs to go up"
before,0,0,q,.servers.startup[],1,,"Get connection management set up"
before,0,0,q,system "sleep 2",1,,"Wait for all connections"
before,0,0,q,stpHandle:gethandle[`stp1],1,,"Get STP handle"
before,0,0,q,rdb1Handle:gethandle[`rdb1],1,,"Get RDB1 handle"
before,0,0,q,rdb2Handle:gethandle[`rdb2],1,,"Get RDB2 handle
before,0,0,q,patcher1Handle:gethandle[`patcher1],1,,"Get patcher1 handle"
before,0,0,q,patcher2Handle:gethandle[`patcher2],1,,"Get patcher2 handle"
run,0,0,q,patcher1Handle (set;`.patch.versiontab;testversiontable),1,,"Change on disk verison tab"
run,0,0,q,patcher1Handle (`applypatch;`proctype;`rdb;`.t1.test;{1+3}),1,,"Patch rdb only"
true,0,0,q,{1+3}~rdb1Handle".t1.test",1,,"Check single patch is applied to rdb1"
true,0,0,q,{1+3}~rdb2Handle".t1.test",1,,"Check single patch is applied to rdb2"
run,0,0,q,ondiskhostA: get testversiontable,1,,"Read in host A new version tab"
run,0,0,q,ondiskhostB: patcher2Handle"get .patch.versiontab",1,,"Read in host B new version tab"
true,0,0,q,"{1+3}~last exec newversion from ondiskhostA where procname=`rdb1,function=`.t1.test",1,,"Check lastest version of function on disk"
true,0,0,q,"{1+3}~last exec newversion from ondiskhostB where procname=`rdb2,function=`.t1.test",1,,"Check lastest version of function on disk"
run,0,0,q,(neg patcher2Handle)"exit 0",1,,"Close patcher2 process"
run,0,0,q,patcher1Handle (`applypatch;`procname;`rdb2;`.t1.test;{1+10}),1,,"Attempt to patch rdb2 using only patcher1"
false,0,0,q,{1+10}~rdb2Handle".t1.test",1,,"check rdb2 has not been updated since patcher2 is not up"
after,0,0,q,"system ""rm "",1_string testversiontable",1,,"Delete test version tab"
after,0,0,q,(neg patcher2Handle)"exit 0",1,,"Close patcher2 process"
after,0,0,q,(neg rdb2Handle)"exit 0",1,,"Close rdb2 process"
