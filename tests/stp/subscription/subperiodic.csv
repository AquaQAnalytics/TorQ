action,ms,bytes,lang,code,repeat,minver,comment
before,0,0,q,stpHandle".stplg.multilog:`periodic",1,,"Change logging type"
before,0,0,q,stpHandle".stplg.init[dbname]",1,,"Init STP log script"
before,0,0,q,stpHandle"init[`defaultbatch]",1,,"Init STP main script"
before,0,0,q,currlog:stpHandle"currlog",1,,"Get STP log table"
before,0,0,q,met:stpHandle".stpm.metatable",1,,"Get STP meta table"
run,0,0,q,"stpHandle @/: `.u.upd ,/: ((`trade;testtrade);(`quote;testquote);(`heartbeat;`error))",1,,"Publish table updates"
run,0,0,q,system "sleep 1",1,,"Wait for update to publish"
run,0,0,q,![-11;] each exec logname from currlog where tbl in `trade`quote`err,1,,"Replay logs locally"
true,0,0,q,"all not raze value exec null logname,null handle from currlog",1,,"Check lognames and handles generated"
true,0,0,q,all currlog[`trade;`logname]=exec logname from currlog where tbl<>`err,1,,"Check lognames are the same"
true,0,0,q,currlog[`trade;`logname]~exec first logname from met,1,,"Check lognames the same in log and meta"
true,0,0,q,(0#trade)~(first exec schema from met)[`trade],1,,"Check trade schema saved to meta table"
true,0,0,q,(0#quote)~(first exec schema from met)[`quote],1,,"Check quote schema saved to meta table"
true,0,0,q,`error~.tst.err,1,,"Check errors were logged to disk"
after,0,0,q,"system ""rm -rf "",1_string stpHandle(`.stplg.dldir)",1,,"Delete logs folder"